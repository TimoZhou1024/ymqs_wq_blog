---
title: 家用NAS的全球访问配置
date: \today
tags: 
- Nas
- DDNS
- FRP
- ipv4
- ipv6
- Cloudflare
categories: 
- tech
---

之前家里的服务器是通过DDNS-GO容器实现了外网访问，最近家中装修，服务器需要迁往别处，由于DDNS-GO的域名解析是基于IPv4的，所以在其他网络环境下不一定能访问，因此需要重新配置。以下是可能的三种方法：

## 1. 使用FRP
FRP（Fast Reverse Proxy）是一个高性能的反向代理应用，可以将内网服务暴露到外网。以下是基本配置步骤：

## 2. 使用ipv6 + DDNS
如果你的ISP提供了IPv6地址，可以直接使用IPv6进行访问。可以使用一个支持IPv6的DDNS服务，将IPv6地址映射到一个域名上。这样无论在何处，都可以通过这个域名访问你的NAS。

### 路由器处打开IPv6
首先以小米路由器为例，进入路由器管理界面`192.168.31.1`，在`常用设置-上网设置`里打开`IPv6网络设置`，建议先关掉防火墙
![IPv6网络设置](https://lsky.ymqs.top/i/2025/08/07/68944049ad905.png)

### 群晖Nas配置IPv6
然后进入群晖的管理页面`192.168.31.172:5000`，首先确认需要打开IPv6，这里设置为自动
![编辑](https://lsky.ymqs.top/i/2025/08/07/68943e3a72b0d.png)
接下来查看ipv6状态
![网络界面](https://lsky.ymqs.top/i/2025/08/07/68943debd6b58.png)

这里需要稍微补充一点关于`IPv6`的知识，这些地址最后有一个`/64`和`/128`，代表子网前缀。

- `/64`：`IPv6`地址的前`64`位用于表示网络部分，后 64 位表示主机部分。这意味着你可以在这个子网范围内分配很多不同的主机地址。
- `/128`：`IPv6`地址的全部`128`位都是网络前缀，表示这是一个单一的、唯一的地址，无法再进一步分配子地址。
假设你看到了下面这一串地址，你应该使用的是`/128`的`2401:821d:2e21:2bdc::103e`来访问你的`NAS`。

而如果只有`fe80`: 开头的`IPv6`地址，那是不行的，因为`fe80`是类似于`IPv4`的`127.0.0.1`中的`127`也就是说这是一个局域网内网的地址。

现在需要验证一下，这台 NAS 能否被外网访问了。验证的方法如下：

- 验证`内网`通了：在 PC/手机上使用内网，浏览器访问 NAS 的内网地址`http://[fe80::211:32fe:fee5:35db]:5000`（DSM 的管理界面），如果OK，说明`内网`的`IPv6`没问题。
- 验证`外网`通了：在手机上使用 5G 网络，模拟外部访问。浏览器访问`NAS`的外网地址 `http://[2401:821d:2e21:2bdc::103e]:5000`，如果OK，说明`外网`的`IPv6`没问题。
注意，`IPv6` 直接访问时必须在地址前后加上中括号 `[]`。然后浏览器必须完整输入 `http://` 和`端口号`，才能正确访问`IPv6`地址。

只有直连`IPv6`没问题了，才能继续后面的`DDNS`配置工作。否则连直连`IPv6`都连不上的话，无论后面怎么配置，都会是无用功。

### DDNS-GO配置
使用docker或者docker-compose部署DDNS-GO容器，注意网络需要选用`host`模式。在域名解析处先建立一条`AAAA`记录，然后在`DDNS-GO`管理界面输入需要DDNS到的域名即可
![DDNS-GO配置](https://lsky.ymqs.top/i/2025/08/07/689445645576e.png)

等待DNS解析生效后，可以在浏览器中输入自定义域名来访问Nas


## 3. 使用Cloudflare Tunnel
Cloudflare Tunnel（以前称为Argo Tunnel）可以将你的NAS服务安全地暴露到互联网上，而无需直接暴露你的IP地址。以下是基本配置步骤：
在Cloudflare主页选择Zero Trust，进入Cloudflare Zero Trust控制台
![Zero Trust](https://lsky.ymqs.top/i/2025/08/07/68944b09ccd76.png)
![Cloudflared](https://lsky.ymqs.top/i/2025/08/07/68944b4209cd4.png)
![创建隧道](https://lsky.ymqs.top/i/2025/08/07/68944b7a418a2.png)
复制生成的命令到终端中执行，可以先配置docker镜像加速访问
![配置](https://lsky.ymqs.top/i/2025/08/07/68944c405de1f.png)
之后填入在`cloudflare`上托管的域名，以及你希望本地被转发的端口，形如`http://localhost:5000`，然后继续下一步
![配置完成](https://lsky.ymqs.top/i/2025/08/07/68944d1e19d42.png)
显示状态正常即可

注意：在群晖部署容器应该部署在host网络，否则无法通过5000端口访问管理页面，这可以在群晖的docker管理页面中自行修改。另外，Tunnel目前只能打开一个端口，该方案目前还没有实现DS File等手机软件的外网访问。

## 参考链接

[2025 年 NAS 公网访问的好方案，配置 IPv6 DDNS 详解](https://utgd.net/article/21030)
[没有公网IP？手把手教你开启IPv6（上）](https://zhuanlan.zhihu.com/p/1932552071816667888)